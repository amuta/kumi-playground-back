(function(){"use strict";let h=null,g={},y=null,c={},a=0;onmessage=async s=>{const t=s.data;try{if(t.type==="init"){const e=await fetch(t.artifactUrl);if(!e.ok)throw new Error(`HTTP ${e.status}`);const n=await e.text();h=await import("data:text/javascript;base64,"+btoa(n)),g=t.schema,y=t.execCfg,c=t.initialInput??{},a=0,f("snapshot",p(null,null));return}if(t.type==="setConfig"){y=t.execCfg;return}if(t.type==="setInput"){c=t.input,a=0,f("snapshot",p(null,null));return}if(t.type==="step"){let e=null,n=null;try{const o=a+1,r={...c,step:o};e={};for(const u of Object.keys(g||{})){const i=h["_"+u];if(typeof i!="function")throw new Error(`Output '${u}' not found`);e[u]=i(r)}e.step=o,a=o,c=d(y,e,r)}catch(o){n=o?.message??"Execution failed"}f("snapshot",p(n,e));return}}catch(e){f("snapshot",p(e?.message??"Worker error",null))}};function p(s,t){return{stepCount:a,input:c,outputs:t,error:s}}function d(s,t,e){const n=s?.continuous?.feedback_mappings??[];if(!n.length)return e;let o=e;for(const{from_output:r,to_input:u}of n){const i=m(t,r);i!==void 0&&(o=k(o,u,i))}return o}function m(s,t){return t.split(".").reduce((e,n)=>e?.[n],s)}function k(s,t,e){const n=t.split("."),o=Array.isArray(s)?s.slice():{...s};let r=o;for(let u=0;u<n.length-1;u++){const i=n[u],l=r[i];r[i]=Array.isArray(l)?l.slice():l&&typeof l=="object"?{...l}:{},r=r[i]}return r[n[n.length-1]]=e,o}function f(s,t){postMessage({type:s,payload:t})}})();
